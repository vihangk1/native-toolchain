From fc187cdf5f44a43bb64bffba65f193fba3343cef Mon Sep 17 00:00:00 2001
From: Vihang Karajgaonkar <vihangk1@apache.org>
Date: Tue, 9 Feb 2021 13:38:34 -0800
Subject: [PATCH] Catch errors around ThriftDebugString

---
 lib/cpp/src/thrift/protocol/TDebugProtocol.h | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/lib/cpp/src/thrift/protocol/TDebugProtocol.h b/lib/cpp/src/thrift/protocol/TDebugProtocol.h
index 41bb0d4e..9c701675 100644
--- a/lib/cpp/src/thrift/protocol/TDebugProtocol.h
+++ b/lib/cpp/src/thrift/protocol/TDebugProtocol.h
@@ -163,7 +163,13 @@ std::string ThriftDebugString(const ThriftStruct& ts) {
   std::shared_ptr<TTransport> trans(buffer);
   TDebugProtocol protocol(trans);
 
-  ts.write(&protocol);
+  try {
+    ts.write(&protocol);
+  } catch(TException e) {
+    return "Unable to write object due to error: " << e.what();
+  } catch (std::bad_alloc& ba) {
+    return "Caught bad_alloc error: " << ba.what();
+  }
 
   uint8_t* buf;
   uint32_t size;
-- 
2.17.1

